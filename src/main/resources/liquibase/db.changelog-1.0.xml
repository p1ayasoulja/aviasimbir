<databaseChangeLog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <changeSet id="1.0" author="Andrey Galanov">
        <sql>
            CREATE SEQUENCE airline_id_seq;
            CREATE SEQUENCE flight_id_seq;
            CREATE SEQUENCE plane_id_seq;
            CREATE SEQUENCE ticket_id_seq;
            CREATE SEQUENCE log_id_seq;
            select setval('flight_id_seq', 5);
            select setval('airline_id_seq', 3);
            select setval('plane_id_seq', 5);
            select setval('ticket_id_seq', 7);
        </sql>
    </changeSet>
    <changeSet id="1.1" author="Andrey Galanov">
        <createTable tableName="plane">
            <column name="id" type="BIGINT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="brand" type="varchar(200)">
                <constraints nullable="false"/>
            </column>
            <column name="model" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="airline" type="bigint">
            </column>
            <column name="seats" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <createTable tableName="airline">
            <column name="id" type="BIGINT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(200)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1.2" author="Andrey Galanov">
        <createTable tableName="flight">
            <column name="id" type="BIGINT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="departure" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="destination" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="departure_time" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="arrival_time" type="timestamp">
                <constraints nullable="false"/>
            </column>
            <column name="plane" type="bigint">
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1.3" author="Andrey Galanov">
        <addForeignKeyConstraint baseColumnNames="plane"
                                 baseTableName="flight"
                                 constraintName="fk_flight_plane"
                                 onDelete="CASCADE"
                                 onUpdate="RESTRICT"
                                 referencedColumnNames="id"
                                 referencedTableName="plane"/>
        <addForeignKeyConstraint baseColumnNames="airline"
                                 baseTableName="plane"
                                 constraintName="fk_plane_airline"
                                 onDelete="CASCADE"
                                 onUpdate="RESTRICT"
                                 referencedColumnNames="id"
                                 referencedTableName="airline"/>
    </changeSet>
    <changeSet id="1.4" author="Andrey Galanov">
        <createTable tableName="ticket">
            <column name="id" type="BIGINT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="price" type="numeric">
                <constraints nullable="false"/>
            </column>
            <column name="reserved" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="sold" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="flight" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="commission" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="order_id" type="bigint">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1.5" author="Andrey Galanov">
        <addForeignKeyConstraint baseColumnNames="flight"
                                 baseTableName="ticket"
                                 constraintName="fk_ticket_flight"
                                 onDelete="CASCADE"
                                 onUpdate="RESTRICT"
                                 referencedColumnNames="id"
                                 referencedTableName="flight"/>
    </changeSet>
    <changeSet id="1.6" author="Andrey Galanov">
        <insert tableName="airline">
            <column name="id" valueComputed="1"/>
            <column name="name" value="AirSerbia"/>
        </insert>
        <insert tableName="airline">
            <column name="id" valueComputed="2"/>
            <column name="name" value="FlyEmirates"/>
        </insert>
        <insert tableName="airline">
            <column name="id" valueComputed="3"/>
            <column name="name" value="FlyAstana"/>
        </insert>
        <insert tableName="plane">
            <column name="id" value="1"/>
            <column name="brand" value="AirBus"/>
            <column name="model" value="M-179"/>
            <column name="airline" value="1"/>
            <column name="seats" value="65"/>
        </insert>
        <insert tableName="plane">
            <column name="id" value="2"/>
            <column name="brand" value="AirBus"/>
            <column name="model" value="M-122"/>
            <column name="airline" value="1"/>
            <column name="seats" value="40"/>
        </insert>
        <insert tableName="plane">
            <column name="id" value="3"/>
            <column name="brand" value="AirBus"/>
            <column name="model" value="K-24"/>
            <column name="airline" value="1"/>
            <column name="seats" value="15"/>
        </insert>
        <insert tableName="plane">
            <column name="id" value="4"/>
            <column name="brand" value="EuroPlane"/>
            <column name="model" value="EU-44"/>
            <column name="airline" value="2"/>
            <column name="seats" value="150"/>
        </insert>
        <insert tableName="plane">
            <column name="id" value="5"/>
            <column name="brand" value="EuroPlane"/>
            <column name="model" value="EU-12"/>
            <column name="airline" value="3"/>
            <column name="seats" value="140"/>
        </insert>
        <insert tableName="flight">
            <column name="id" value="1"/>
            <column name="departure" value="Belgrade"/>
            <column name="destination" value="Kazan"/>
            <column name="departure_time" value="2023-03-16 10:20:15"/>
            <column name="arrival_time" value="2023-03-16 15:15:15"/>
            <column name="plane" value="1"/>
        </insert>
        <insert tableName="flight">
            <column name="id" value="2"/>
            <column name="departure" value="Zagreb"/>
            <column name="destination" value="Kazan"/>
            <column name="departure_time" value="2023-03-14 12:12:15"/>
            <column name="arrival_time" value="2023-03-14 17:20:15"/>
            <column name="plane" value="2"/>
        </insert>
        <insert tableName="flight">
            <column name="id" value="3"/>
            <column name="departure" value="Zagreb"/>
            <column name="destination" value="Belgrade"/>
            <column name="departure_time" value="2023-04-14 22:12:15"/>
            <column name="arrival_time" value="2023-04-15 01:20:15"/>
            <column name="plane" value="3"/>
        </insert>
        <insert tableName="flight">
            <column name="id" value="4"/>
            <column name="departure" value="Dubai"/>
            <column name="destination" value="Kazan"/>
            <column name="departure_time" value="2022-05-14 23:12:15"/>
            <column name="arrival_time" value="2022-05-15 07:20:15"/>
            <column name="plane" value="4"/>
        </insert>
        <insert tableName="flight">
            <column name="id" value="5"/>
            <column name="departure" value="Astana"/>
            <column name="destination" value="Kazan"/>
            <column name="departure_time" value="2023-05-10 23:12:15"/>
            <column name="arrival_time" value="2023-05-11 07:20:15"/>
            <column name="plane" value="5"/>
        </insert>

        <insert tableName="ticket">
            <column name="id" value="1"/>
            <column name="flight" value="1"/>
            <column name="price" value="17000"/>
            <column name="reserved" value="false"/>
            <column name="sold" value="false"/>
            <column name="commission" value="false"/>
            <column name="order_id" value="null"/>
        </insert>
        <insert tableName="ticket">
            <column name="id" value="2"/>
            <column name="flight" value="1"/>
            <column name="price" value="15000"/>
            <column name="reserved" value="false"/>
            <column name="sold" value="false"/>
            <column name="commission" value="false"/>
            <column name="order_id" value="null"/>
        </insert>
        <insert tableName="ticket">
            <column name="id" value="3"/>
            <column name="flight" value="1"/>
            <column name="price" value="122000"/>
            <column name="reserved" value="false"/>
            <column name="sold" value="false"/>
            <column name="commission" value="false"/>
            <column name="order_id" value="null"/>
        </insert>
        <insert tableName="ticket">
            <column name="id" value="4"/>
            <column name="flight" value="2"/>
            <column name="price" value="132000"/>
            <column name="reserved" value="false"/>
            <column name="sold" value="false"/>
            <column name="commission" value="false"/>
            <column name="order_id" value="null"/>
        </insert>
        <insert tableName="ticket">
            <column name="id" value="5"/>
            <column name="flight" value="3"/>
            <column name="price" value="12000"/>
            <column name="reserved" value="false"/>
            <column name="sold" value="false"/>
            <column name="commission" value="false"/>
            <column name="order_id" value="null"/>
        </insert>
        <insert tableName="ticket">
            <column name="id" value="6"/>
            <column name="flight" value="4"/>
            <column name="price" value="11000"/>
            <column name="reserved" value="false"/>
            <column name="sold" value="false"/>
            <column name="commission" value="false"/>
            <column name="order_id" value="null"/>
        </insert>
        <insert tableName="ticket">
            <column name="id" value="7"/>
            <column name="flight" value="5"/>
            <column name="price" value="12400"/>
            <column name="reserved" value="false"/>
            <column name="sold" value="false"/>
            <column name="commission" value="false"/>
            <column name="order_id" value="null"/>
        </insert>
    </changeSet>
    <changeSet id="1.7" author="Andrey Galanov">
        <createTable tableName="log">
            <column name="id" type="BIGINT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="time" type="timestamp">
                <constraints nullable="false"/>
            </column>
            <column name="title" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1.8" author="Andrey Galanov">
        <sql>
            CREATE SEQUENCE user_id_seq;
            select setval('user_id_seq', 3);
        </sql>
    </changeSet>
    <changeSet id="1.9" author="Andrey Galanov">
        <createTable tableName="users">
            <column name="id" type="BIGINT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="username" type="varchar(200)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="password" type="varchar(200)">
                <constraints nullable="false"/>
            </column>
            <column name="role" type="varchar(200)">
                <constraints nullable="false"/>
            </column>
            <column name="airline" type="bigint">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="2.0" author="Andrey Galanov">
        <insert tableName="users">
            <column name="id" value="1"/>
            <column name="username" value="yandy1"/>
            <column name="password" value="$2a$10$NGE2TGlNuqOkb3XOYAmW4uJDbpFM0dxPpx3VWY5iKr/rLV7ZP0b9y"/>
            <column name="role" value="REPRESENTATIVE"/>
            <column name="airline" value="1"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="2"/>
            <column name="username" value="yandy2"/>
            <column name="password" value="$2a$10$NGE2TGlNuqOkb3XOYAmW4uJDbpFM0dxPpx3VWY5iKr/rLV7ZP0b9y"/>
            <column name="role" value="CASHIER"/>
            <column name="airline" value="null"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="3"/>
            <column name="username" value="yandy3"/>
            <column name="password" value="$2a$10$NGE2TGlNuqOkb3XOYAmW4uJDbpFM0dxPpx3VWY5iKr/rLV7ZP0b9y"/>
            <column name="role" value="CUSTOMER"/>
            <column name="airline" value="null"/>
        </insert>
    </changeSet>
    <changeSet id="2.1" author="Andrey Galanov">
        <insert tableName="users">
            <column name="id" value="4"/>
            <column name="username" value="yandy4"/>
            <column name="password" value="$2a$10$NGE2TGlNuqOkb3XOYAmW4uJDbpFM0dxPpx3VWY5iKr/rLV7ZP0b9y"/>
            <column name="role" value="MANAGER"/>
            <column name="airline" value="null"/>
        </insert>
    </changeSet>
    <changeSet id="2.2" author="Andrey Galanov">
        <sql>
            CREATE SEQUENCE promocode_id_seq;
            select setval('promocode_id_seq', 3);
        </sql>
    </changeSet>
    <changeSet id="2.3" author="Andrey Galanov">
        <createTable tableName="promocode">
            <column name="id" type="BIGINT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="code" type="varchar">
                <constraints nullable="false"/>
            </column>
            <column name="expiration_date" type="TIMESTAMP">
                <constraints nullable="true"/>
            </column>
            <column name="uses" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="max_uses" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="discount" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="2.4" author="Andrey Galanov">
        <insert tableName="promocode">
            <column name="id" value="1"/>
            <column name="code" value="ONLINE15"/>
            <column name="expiration_date" value="2025-01-01 00:00:01"/>
            <column name="uses" value="0"/>
            <column name="max_uses" value="100"/>
            <column name="discount" value="15"/>
        </insert>
        <insert tableName="promocode">
            <column name="id" value="2"/>
            <column name="code" value="GET10OFF"/>
            <column name="expiration_date" value="2023-01-01 00:00:01"/>
            <column name="uses" value="0"/>
            <column name="max_uses" value="200"/>
            <column name="discount" value="10"/>
        </insert>
        <insert tableName="promocode">
            <column name="id" value="3"/>
            <column name="code" value="LUCKY99"/>
            <column name="expiration_date" value="2026-01-01 00:00:01"/>
            <column name="uses" value="0"/>
            <column name="max_uses" value="2"/>
            <column name="discount" value="99"/>
        </insert>
    </changeSet>
    <changeSet id="2.5" author="Andrey Galanov">
        <sql>
            CREATE SEQUENCE ordr_id_seq;
        </sql>
    </changeSet>
    <changeSet id="2.6" author="Andrey Galanov">
        <createTable tableName="orders">
            <column name="id" type="BIGINT">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="total_price" type="numeric">
                <constraints nullable="false"/>
            </column>
            <column name="active_until" type="TIMESTAMP">
                <constraints nullable="true"/>
            </column>
            <column name="status" type="varchar">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="2.7" author="Andrey Galanov">
        <addForeignKeyConstraint baseColumnNames="order_id"
                                 baseTableName="ticket"
                                 constraintName="fk_ticket_orders"
                                 onDelete="RESTRICT"
                                 onUpdate="RESTRICT"
                                 referencedColumnNames="id"
                                 referencedTableName="orders"/>
    </changeSet>


</databaseChangeLog>